<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Suhoor to Iftar</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
*{box-sizing:border-box;margin:0;padding:0;}
html,body{height:100%;overflow:hidden;}
body{font-family:'Inter',system-ui,sans-serif;background:#2e8b57;color:#e0e8e4;-webkit-font-smoothing:antialiased;}
canvas#face{display:none;}
#gl{position:fixed;top:0;left:0;width:100vw;height:100vh;}
.info{position:fixed;bottom:16px;left:50%;transform:translateX(-50%);z-index:10;text-align:center;display:flex;flex-direction:column;align-items:center;gap:4px;pointer-events:none;transition:color 1s;}
.info>*{pointer-events:auto;}
.ramadan-label{font-size:10px;font-weight:600;color:rgba(255,255,240,.7);text-transform:uppercase;letter-spacing:.14em;}
.hijri{font-size:12px;font-weight:500;color:rgba(255,255,240,.6);}
.greg{font-size:10px;color:rgba(255,255,240,.35);}
.fast-status{font-size:13px;font-weight:500;color:rgba(255,255,240,.8);}.fast-status .tl{color:#f0e060;font-variant-numeric:tabular-nums;}
.prayers{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:2px;}
.pp{display:flex;align-items:center;gap:4px;font-size:9px;color:rgba(255,255,240,.4);padding:3px 8px;background:rgba(0,0,0,.1);border:1px solid rgba(255,255,240,.08);border-radius:16px;backdrop-filter:blur(4px);}
.pp .dot{width:4px;height:4px;border-radius:50%;}
.pp .pt{color:rgba(255,255,240,.7);font-weight:500;font-variant-numeric:tabular-nums;}
.pp.active{border-color:rgba(255,255,240,.25);background:rgba(0,0,0,.15);}
.pp.next{border-color:rgba(240,224,96,.3);background:rgba(240,224,96,.06);}
.loc{font-size:9px;color:rgba(255,255,240,.2);cursor:pointer;margin-top:2px;}
.loc:hover{color:rgba(255,255,240,.4);}
.sov{display:none;position:fixed;inset:0;background:rgba(0,20,10,.7);backdrop-filter:blur(12px);z-index:100;align-items:center;justify-content:center;}
.sov.open{display:flex;}
.scard{background:rgba(20,50,30,.95);border:1px solid rgba(255,255,240,.1);border-radius:16px;padding:28px;width:min(90vw,340px);max-height:80vh;overflow-y:auto;}
.scard h3{font-size:15px;font-weight:600;margin-bottom:16px;color:#f0e060;}
.sr{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid rgba(255,255,240,.05);}.sr:last-child{border-bottom:none;}
.sl{font-size:12px;color:rgba(255,255,240,.5);}
.sv{font-size:12px;color:rgba(255,255,240,.8);background:rgba(255,255,240,.06);border:1px solid rgba(255,255,240,.1);border-radius:6px;padding:4px 10px;}
select.sv{-webkit-appearance:none;appearance:none;padding-right:24px;background:rgba(255,255,240,.06) url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6'%3E%3Cpath d='M0 0l5 6 5-6z' fill='rgba(255,255,240,.4)'/%3E%3C/svg%3E") no-repeat right 8px center;}
input.sv{width:140px;border:1px solid rgba(255,255,240,.1);color:rgba(255,255,240,.8);}
.sbtn{margin-top:16px;width:100%;padding:10px;font-size:12px;font-weight:500;background:rgba(240,224,96,.12);border:1px solid rgba(240,224,96,.4);border-radius:8px;color:#f0e060;cursor:pointer;}
</style>
</head>
<body>
<canvas id="face" width="2048" height="2048"></canvas>
<div id="gl"></div>
<div class="info">
  <div class="ramadan-label" id="ramLabel"></div>
  <div class="fast-status" id="fastStatus"></div>
  <div class="prayers" id="prayers"></div>
  <div class="hijri" id="hijri"></div>
  <div class="greg" id="greg"></div>
  <div class="loc" id="loc" onclick="openSettings()">üìç Loading‚Ä¶ ‚öôÔ∏è</div>
</div>
<div class="sov" id="sov" onclick="if(event.target===this)closeSettings()">
  <div class="scard">
    <h3>‚ò™ Settings</h3>
    <div class="sr"><span class="sl">City</span><input class="sv" id="sCity" value="Los Angeles"></div>
    <div class="sr"><span class="sl">Country</span><input class="sv" id="sCountry" value="US"></div>
    <div class="sr"><span class="sl">Calculation</span>
      <select class="sv" id="sMethod">
        <option value="2" selected>ISNA</option><option value="1">Karachi</option>
        <option value="3">MWL</option><option value="4">Umm Al-Qura</option>
        <option value="5">Egyptian</option><option value="15">Moonsighting</option>
      </select>
    </div>
    <div class="sr"><span class="sl">Numerals</span>
      <select class="sv" id="sNum">
        <option value="arabic" selected>Arabic-Indic</option>
        <option value="western">Western</option>
        <option value="both">Both</option>
        <option value="none">None</option>
      </select>
    </div>
    <button class="sbtn" onclick="saveSettings()">Save & Refresh</button>
  </div>
</div>

<div id="devPanel" style="display:none;position:fixed;top:16px;left:50%;transform:translateX(-50%);z-index:100;background:rgba(0,0,0,.85);backdrop-filter:blur(12px);border:1px solid rgba(240,224,96,.3);border-radius:12px;padding:14px 20px;gap:10px;flex-direction:column;align-items:center;font-size:12px;color:rgba(255,255,240,.8);min-width:320px;">
  <div style="display:flex;align-items:center;gap:8px;width:100%;">
    <span style="color:#f0e060;font-weight:600;font-size:11px;letter-spacing:.1em;">DEV MODE</span>
    <span style="flex:1"></span>
    <span id="devTimeLabel" style="font-variant-numeric:tabular-nums;font-weight:500;">--:--</span>
  </div>
  <input type="range" id="devSlider" min="0" max="1439" step="0.5" value="720" style="width:100%;accent-color:#f0e060;cursor:pointer;" oninput="devTimeMin=parseFloat(this.value);document.getElementById('devTimeLabel').textContent=((h,m)=>(h%12||12)+':'+String(m).padStart(2,'0')+(h>=12?' PM':' AM'))(Math.floor(this.value/60),Math.floor(this.value%60));updateInfo();">
  <div style="display:flex;gap:12px;align-items:center;width:100%;margin-top:4px;">
    <label style="display:flex;align-items:center;gap:6px;cursor:pointer;"><input type="checkbox" id="devRamToggle" onchange="devRamadan=this.checked;updateInfo();" style="accent-color:#f0e060;"> <span style="font-size:11px;">Simulate Ramadan</span></label>
    <span style="flex:1"></span>
    <button onclick="devTimeMin=null;document.getElementById('devSlider').value=720;document.getElementById('devTimeLabel').textContent='LIVE';updateInfo();" style="font-size:10px;padding:4px 10px;background:rgba(240,224,96,.15);border:1px solid rgba(240,224,96,.3);border-radius:6px;color:#f0e060;cursor:pointer;">Reset to Live</button>
  </div>
</div>
<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// 2D CLOCK FACE (rendered to offscreen canvas)
// Exact same rendering as v4
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const fc=document.getElementById('face');
const fctx=fc.getContext('2d');
const FS=2048; // face texture size
let nightMode=0; // 0=day, 1=full night (lerped)

// Settings
function loadS(){try{const s=JSON.parse(localStorage.getItem('rc6')||'{}');return{city:s.city||'Los Angeles',country:s.country||'US',method:s.method||'2',numerals:s.numerals||'arabic'};}catch(e){return{city:'Los Angeles',country:'US',method:'2',numerals:'arabic'};}}
let S=loadS();
window.openSettings=()=>{document.getElementById('sCity').value=S.city;document.getElementById('sCountry').value=S.country;document.getElementById('sMethod').value=S.method;document.getElementById('sNum').value=S.numerals;document.getElementById('sov').classList.add('open');};
window.closeSettings=()=>document.getElementById('sov').classList.remove('open');
window.saveSettings=()=>{S.city=document.getElementById('sCity').value.trim()||'Los Angeles';S.country=document.getElementById('sCountry').value.trim()||'US';S.method=document.getElementById('sMethod').value;S.numerals=document.getElementById('sNum').value;localStorage.setItem('rc6',JSON.stringify(S));closeSettings();fetchPrayer();};

// ‚îÄ‚îÄ DEV MODE ‚îÄ‚îÄ
// Double-tap/click the clock to toggle. Slider scrubs time, Ramadan toggle simulates Ramadan.
let devMode=false, devTimeMin=null, devRamadan=false;
function devNow(){
  if(devTimeMin!==null){const h=Math.floor(devTimeMin/60),m=Math.floor(devTimeMin%60),s=Math.floor((devTimeMin%1)*60);const d=new Date();d.setHours(h,m,s,0);return d;}
  return new Date();
}
function devNM(){return devTimeMin!==null?devTimeMin:(() => {const d=new Date();return d.getHours()*60+d.getMinutes()+d.getSeconds()/60;})();}
function toggleDev(){
  devMode=!devMode;
  document.getElementById('devPanel').style.display=devMode?'flex':'none';
  if(!devMode){devTimeMin=null;devRamadan=false;updateInfo();}
}
let lastTap=0;
document.getElementById('gl').addEventListener('dblclick',toggleDev);
document.getElementById('gl').addEventListener('touchend',e=>{const now=Date.now();if(now-lastTap<350){e.preventDefault();toggleDev();}lastTap=now;});
document.addEventListener('keydown',e=>{if(e.key==='Escape')closeSettings();});

// Prayer
let PD=null,DD=null;
const PC={Fajr:'#6ba0c4',Sunrise:'#e8c060',Dhuhr:'#f0e060',Asr:'#e0b050',Maghrib:'#d06040',Isha:'#8a7abf'};
const PN=['Fajr','Sunrise','Dhuhr','Asr','Maghrib','Isha'];
function pM(s){if(!s)return 0;const[h,m]=s.split(':').map(Number);return h*60+m;}
function nM(){return devNM();}
function f12(m){const h=Math.floor(m/60),mi=Math.floor(m%60);return`${h%12||12}:${String(mi).padStart(2,'0')}${h>=12?'p':'a'}`;}
const MN={'1':'Karachi','2':'ISNA','3':'MWL','4':'Umm Al-Qura','5':'Egyptian','7':'Tehran','8':'Gulf','15':'Moonsighting'};
async function fetchPrayer(){try{const r=await fetch(`https://api.aladhan.com/v1/timingsByCity?city=${encodeURIComponent(S.city)}&country=${encodeURIComponent(S.country)}&method=${S.method}`);const j=await r.json();if(j.code===200){PD=j.data.timings;DD=j.data.date;updateInfo();}}catch(e){document.getElementById('loc').textContent='üìç Failed ‚Äî tap ‚öôÔ∏è';}}
function updateInfo(){
  if(!DD)return;
  const h=DD.hijri,g=DD.gregorian;
  document.getElementById('hijri').textContent=`${h.day} ${h.month.en} ${h.year} AH`;
  document.getElementById('greg').textContent=`${g.weekday.en}, ${g.day} ${g.month.en} ${g.year}`;
  document.getElementById('loc').textContent=`üìç ${S.city} ¬∑ ${MN[S.method]||'ISNA'} ‚öôÔ∏è`;
  const lbl=document.getElementById('ramLabel');
  const isRam=devRamadan||h.month.number===9;
  if(isRam)lbl.textContent=`RAMADAN ¬∑ DAY ${devRamadan?'15':h.day}`;
  else if(h.month.number===8){const dl=(h.month.days||30)-parseInt(h.day);lbl.textContent=dl<=15?`${dl} DAYS TO RAMADAN`:`SHA'BƒÄN ${h.day}`;}
  else lbl.textContent='';
  const now=nM();const ps=PN.map(n=>({name:n,time:pM(PD[n]),color:PC[n]}));
  let ni=ps.findIndex(p=>p.time>now);if(ni===-1)ni=0;let ci=ni-1;if(ci<0)ci=ps.length-1;
  document.getElementById('prayers').innerHTML=ps.map((p,i)=>`<div class="pp ${i===ci?'active':i===ni?'next':''}"><span class="dot" style="background:${p.color}"></span>${p.name} <span class="pt">${f12(p.time)}</span></div>`).join('');
  const fajr=pM(PD.Fajr),mag=pM(PD.Maghrib),el=document.getElementById('fastStatus');
  if(isRam){if(now>=fajr&&now<mag){const l=mag-now;el.innerHTML=`Fasting ¬∑ <span class="tl">${Math.floor(l/60)}h ${Math.floor(l%60)}m to Iftar</span>`;}else if(now<fajr){const l=fajr-now;el.innerHTML=`Suhoor ¬∑ <span class="tl">${Math.floor(l/60)}h ${Math.floor(l%60)}m to Fajr</span>`;}else el.innerHTML=`<span style="color:#f0e060">Iftar Mubarak ‚ò™</span>`;}else{el.innerHTML=`Fajr <span class="tl">${f12(fajr)}</span> ¬∑ Maghrib <span class="tl">${f12(mag)}</span>`;}
}

// Sun
function getSun(){
  if(!PD)return{isDay:true,elevation:0.5,progress:0.5};
  const now=nM(),sr=pM(PD.Sunrise),ss=pM(PD.Sunset||PD.Maghrib);
  if(sr>=ss)return{isDay:true,elevation:0.5,progress:0.5};
  const isDay=now>=sr&&now<=ss;
  const progress=isDay?Math.max(0,Math.min(1,(now-sr)/(ss-sr))):0;
  const elevation=isDay?Math.sin(progress*Math.PI):0;
  return{isDay,elevation,progress};
}

// ‚îÄ‚îÄ 2D Face Colors (interpolated day/night) ‚îÄ‚îÄ
function lerp(a,b,t){return a+(b-a)*t;}
function lerpHex(day,night,t){
  const d=[parseInt(day.slice(1,3),16),parseInt(day.slice(3,5),16),parseInt(day.slice(5,7),16)];
  const n=[parseInt(night.slice(1,3),16),parseInt(night.slice(3,5),16),parseInt(night.slice(5,7),16)];
  const r=Math.round(lerp(d[0],n[0],t)),g=Math.round(lerp(d[1],n[1],t)),b=Math.round(lerp(d[2],n[2],t));
  return`rgb(${r},${g},${b})`;
}

const ARABIC=['Ÿ°Ÿ¢','Ÿ°','Ÿ¢','Ÿ£','Ÿ§','Ÿ•','Ÿ¶','Ÿß','Ÿ®','Ÿ©','Ÿ°Ÿ†','Ÿ°Ÿ°'];
const WESTERN=['12','1','2','3','4','5','6','7','8','9','10','11'];
const MIN_LABELS=['60','','','','','05','','','','','10','','','','','15','','','','','20','','','','','25','','','','','30','','','','','35','','','','','40','','','','','45','','','','','50','','','','','55','','','',''];

function drawFaceTexture(){
  const c=fctx, S2=FS, cx=S2/2, cy=S2/2, R=S2*0.42;
  const n=nightMode;

  // Background
  const bg=lerpHex('#35a065','#0a1e14',n);
  const bgEdge=lerpHex('#267a4c','#06120c',n);
  const g=c.createRadialGradient(cx,cy-R*0.3,0,cx,cy,R*1.6);
  g.addColorStop(0,bg);g.addColorStop(1,bgEdge);
  c.fillStyle=g;c.fillRect(0,0,S2,S2);

  // Stipple texture
  c.globalAlpha=0.012;
  for(let i=0;i<600;i++){c.fillStyle=Math.random()>0.5?'#fff':'#000';c.fillRect(Math.random()*S2,Math.random()*S2,2,2);}
  c.globalAlpha=1;

  // Lume colors
  const lumeDay='#c8e860';
  const lumeNight='#d0f070';
  const lume=lerpHex(lumeDay,lumeNight,n);
  const lumeDim=lerpHex('#6aaa50','#80c050',n);
  const lumeGlow=lerp(0.15,0.6,n);
  const handFill=lerpHex('#f4f0e0','#e0dcc8',n);

  // Hour indices (capsules)
  for(let i=0;i<60;i++){
    const ang=(i/60)*Math.PI*2-Math.PI/2;
    const isHour=i%5===0;
    if(isHour){
      const inner=R-R*0.18, outer=R-R*0.03, capW=R*0.035;
      // Shadow
      c.save();
      c.translate(cx+Math.cos(ang)*((inner+outer)/2)+3, cy+Math.sin(ang)*((inner+outer)/2)+4);
      c.rotate(ang+Math.PI/2);
      c.fillStyle='rgba(0,30,15,.25)';
      roundRect(c,-capW,(outer-inner)/-2,capW*2,outer-inner,capW);c.fill();
      c.restore();
      // Capsule
      c.save();
      c.translate(cx+Math.cos(ang)*((inner+outer)/2), cy+Math.sin(ang)*((inner+outer)/2));
      c.rotate(ang+Math.PI/2);
      c.shadowColor=`rgba(200,232,96,${lumeGlow})`;c.shadowBlur=20+n*30;
      c.fillStyle=lume;
      roundRect(c,-capW,(outer-inner)/-2,capW*2,outer-inner,capW);c.fill();
      c.shadowBlur=0;
      c.fillStyle=`rgba(255,255,240,${0.2+n*0.1})`;
      roundRect(c,-capW*0.5,(outer-inner)/-2+3,capW,outer-inner-6,capW*0.5);c.fill();
      c.restore();
    }else{
      const inner=R-R*0.07, outer=R-R*0.03;
      c.strokeStyle=lumeDim;c.lineWidth=2.5;c.lineCap='round';
      if(n>0.3){c.shadowColor=`rgba(128,192,80,${n*0.3})`;c.shadowBlur=6;}
      c.beginPath();c.moveTo(cx+Math.cos(ang)*inner,cy+Math.sin(ang)*inner);c.lineTo(cx+Math.cos(ang)*outer,cy+Math.sin(ang)*outer);c.stroke();
      c.shadowBlur=0;
    }
  }

  // Numerals
  if(S.numerals!=='none'){
    const showA=S.numerals==='arabic'||S.numerals==='both';
    const showW=S.numerals==='western'||S.numerals==='both';
    for(let i=0;i<12;i++){
      const ang=(i/12)*Math.PI*2-Math.PI/2;
      if(showA&&showW){
        const rA=R-R*0.3,rW=R-R*0.42;
        c.textAlign='center';c.textBaseline='middle';
        c.font=`700 ${R*0.1}px Inter,system-ui,sans-serif`;
        c.fillStyle=lume;c.shadowColor=`rgba(200,232,96,${lumeGlow*0.6})`;c.shadowBlur=n>0.3?12:0;
        c.fillText(ARABIC[i],cx+Math.cos(ang)*rA,cy+Math.sin(ang)*rA);
        c.shadowBlur=0;c.font=`400 ${R*0.05}px Inter`;c.fillStyle=lumeDim;
        c.fillText(WESTERN[i],cx+Math.cos(ang)*rW,cy+Math.sin(ang)*rW);
      }else{
        const r=R-R*0.32;const nums=showA?ARABIC:WESTERN;
        c.textAlign='center';c.textBaseline='middle';c.font=`700 ${R*0.11}px Inter,system-ui,sans-serif`;
        c.fillStyle=lume;c.shadowColor=`rgba(200,232,96,${lumeGlow*0.6})`;c.shadowBlur=n>0.3?12:0;
        c.fillText(nums[i],cx+Math.cos(ang)*r,cy+Math.sin(ang)*r);c.shadowBlur=0;
      }
    }
    // Minute numerals
    for(let i=0;i<60;i+=5){
      const ang=(i/60)*Math.PI*2-Math.PI/2;const r=R+R*0.06;
      if(!MIN_LABELS[i])continue;
      c.textAlign='center';c.textBaseline='middle';c.font=`500 ${R*0.045}px Inter`;
      c.fillStyle=`rgba(200,232,96,${0.25+n*0.15})`;
      c.fillText(MIN_LABELS[i],cx+Math.cos(ang)*r,cy+Math.sin(ang)*r);
    }
  }

  // Fasting arc
  if(PD){
    const fajr=pM(PD.Fajr),mag=pM(PD.Maghrib),now=nM();
    const sa=((fajr%720)/720)*Math.PI*2-Math.PI/2;
    const ea=((mag%720)/720)*Math.PI*2-Math.PI/2;
    const arcR=R+R*0.14;
    c.strokeStyle=`rgba(240,224,96,${0.08+n*0.08})`;c.lineWidth=6;c.lineCap='round';
    c.beginPath();c.arc(cx,cy,arcR,sa,ea);c.stroke();
    if(now>=fajr&&now<=mag){
      const na=((now%720)/720)*Math.PI*2-Math.PI/2;
      c.strokeStyle=`rgba(240,224,96,${0.25+n*0.15})`;c.lineWidth=6;c.lineCap='round';
      c.beginPath();c.arc(cx,cy,arcR,sa,na);c.stroke();
      c.fillStyle='#f0e060';c.shadowColor=`rgba(240,224,96,${0.3+n*0.2})`;c.shadowBlur=12;
      c.beginPath();c.arc(cx+Math.cos(na)*arcR,cy+Math.sin(na)*arcR,5,0,Math.PI*2);c.fill();
      c.shadowBlur=0;
    }
  }

  // Hands
  const now=devNow();
  const h=now.getHours()%12,m=now.getMinutes(),s=now.getSeconds(),ms=now.getMilliseconds();
  const sec=s+ms/1000,min=m+sec/60,hour=h+min/60;
  const hourAng=(hour/12)*Math.PI*2-Math.PI/2;
  const minAng=(min/60)*Math.PI*2-Math.PI/2;
  const secAng=(sec/60)*Math.PI*2-Math.PI/2;

  drawTaperedHand(c,cx,cy,hourAng,R*0.52,R*0.028,R*0.008,R*0.06,handFill,lume,lumeGlow,n);
  drawTaperedHand(c,cx,cy,minAng,R*0.72,R*0.022,R*0.005,R*0.08,handFill,lume,lumeGlow,n);

  // Second hand
  const secLen=R*0.78,secTail=R*0.18;
  c.save();c.translate(3,4);c.strokeStyle='rgba(0,30,15,.2)';c.lineWidth=2.5;c.lineCap='round';
  c.beginPath();c.moveTo(cx-Math.cos(secAng)*secTail,cy-Math.sin(secAng)*secTail);c.lineTo(cx+Math.cos(secAng)*secLen,cy+Math.sin(secAng)*secLen);c.stroke();c.restore();
  c.strokeStyle=handFill;c.lineWidth=2.5;c.lineCap='round';
  c.beginPath();c.moveTo(cx-Math.cos(secAng)*secTail,cy-Math.sin(secAng)*secTail);c.lineTo(cx+Math.cos(secAng)*secLen,cy+Math.sin(secAng)*secLen);c.stroke();

  // Center
  c.save();c.shadowColor='rgba(0,20,10,.3)';c.shadowBlur=12;c.shadowOffsetY=4;
  c.fillStyle='#e8e4d8';c.beginPath();c.arc(cx,cy,R*0.035,0,Math.PI*2);c.fill();c.restore();
  c.fillStyle='#444';c.beginPath();c.arc(cx,cy,R*0.012,0,Math.PI*2);c.fill();
}

function drawTaperedHand(c,cx,cy,angle,length,baseW,tipW,tail,fill,lume,lumeGlow,n){
  const tipX=cx+Math.cos(angle)*length,tipY=cy+Math.sin(angle)*length;
  const tailX=cx-Math.cos(angle)*tail,tailY=cy-Math.sin(angle)*tail;
  const px=Math.cos(angle+Math.PI/2),py=Math.sin(angle+Math.PI/2);
  // Shadow
  c.save();c.translate(3,4);c.fillStyle='rgba(0,30,15,.2)';
  c.beginPath();c.moveTo(tailX-px*baseW,tailY-py*baseW);c.lineTo(tipX-px*tipW,tipY-py*tipW);c.lineTo(tipX+px*tipW,tipY+py*tipW);c.lineTo(tailX+px*baseW,tailY+py*baseW);c.closePath();c.fill();c.restore();
  // Body
  c.fillStyle=fill;c.strokeStyle='rgba(255,255,255,.15)';c.lineWidth=1;
  c.beginPath();c.moveTo(tailX-px*baseW,tailY-py*baseW);c.lineTo(tipX-px*tipW,tipY-py*tipW);c.lineTo(tipX+px*tipW,tipY+py*tipW);c.lineTo(tailX+px*baseW,tailY+py*baseW);c.closePath();c.fill();c.stroke();
  // Lume strip
  c.strokeStyle=lume;c.lineWidth=baseW*0.5;c.lineCap='round';
  if(n>0.2){c.shadowColor=`rgba(200,232,96,${lumeGlow*0.5})`;c.shadowBlur=8;}
  c.beginPath();c.moveTo(tailX+Math.cos(angle)*baseW*2.5,tailY+Math.sin(angle)*baseW*2.5);c.lineTo(tipX-Math.cos(angle)*tipW*5,tipY-Math.sin(angle)*tipW*5);c.stroke();
  c.shadowBlur=0;
}

function roundRect(c,x,y,w,h,r){c.beginPath();c.moveTo(x+r,y);c.lineTo(x+w-r,y);c.quadraticCurveTo(x+w,y,x+w,y+r);c.lineTo(x+w,y+h-r);c.quadraticCurveTo(x+w,y+h,x+w-r,y+h);c.lineTo(x+r,y+h);c.quadraticCurveTo(x,y+h,x,y+h-r);c.lineTo(x,y+r);c.quadraticCurveTo(x,y,x+r,y);c.closePath();}
</script>

<!-- Three.js glass overlay -->
<script type="importmap">
{"imports":{"three":"https://cdn.jsdelivr.net/npm/three@0.170.0/build/three.module.js","three/addons/":"https://cdn.jsdelivr.net/npm/three@0.170.0/examples/jsm/"}}
</script>
<script type="module">
import * as THREE from 'three';

const container=document.getElementById('gl');
const scene=new THREE.Scene();
const camera=new THREE.OrthographicCamera(-1,1,1,-1,0.1,10);
camera.position.z=2;

const renderer=new THREE.WebGLRenderer({antialias:true,alpha:true});
renderer.setSize(window.innerWidth,window.innerHeight);
renderer.setPixelRatio(Math.min(window.devicePixelRatio,2));
renderer.toneMapping=THREE.ACESFilmicToneMapping;
renderer.toneMappingExposure=1.2;
container.appendChild(renderer.domElement);

// Face texture from 2D canvas
const faceCanvas=document.getElementById('face');
const faceTex=new THREE.CanvasTexture(faceCanvas);
faceTex.minFilter=THREE.LinearFilter;
faceTex.magFilter=THREE.LinearFilter;

// Full-screen quad with face texture
const quadMat=new THREE.MeshBasicMaterial({map:faceTex});
const quad=new THREE.Mesh(new THREE.PlaneGeometry(2,2),quadMat);
quad.position.z=-0.5;
scene.add(quad);

// Glass dome ‚Äî subtle, over the clock area
const glassMat=new THREE.MeshPhysicalMaterial({
  color:0xffffff,metalness:0,roughness:0.03,
  transmission:0.96,thickness:0.2,ior:1.5,
  clearcoat:1,clearcoatRoughness:0.08,
  transparent:true,opacity:0.06
});
const glassR=0.85; // covers the dial area
const glassDome=new THREE.Mesh(new THREE.SphereGeometry(glassR,64,32,0,Math.PI*2,0,Math.PI/2),glassMat);
glassDome.scale.z=0.06;
glassDome.position.z=0.01;
scene.add(glassDome);

// Light that moves with the sun
const sunLight=new THREE.DirectionalLight(0xfff5e6,0.8);
sunLight.position.set(2,3,4);
scene.add(sunLight);

const ambLight=new THREE.AmbientLight(0xffffff,0.3);
scene.add(ambLight);

// Update sun position on the glass
function updateGlassLight(){
  const sun=window.getSun?window.getSun():{isDay:true,elevation:0.5,progress:0.5};
  if(sun.isDay){
    const x=Math.cos(sun.progress*Math.PI)*3;
    const y=0.5+sun.elevation*3;
    sunLight.position.set(x,y,4);
    sunLight.intensity=0.5+sun.elevation*0.8;
    sunLight.color.setRGB(1,0.95,0.85);
    // Golden hour
    if(sun.progress<0.12||sun.progress>0.85){sunLight.color.setRGB(1,0.82,0.6);sunLight.intensity=1.2;}
  }else{
    sunLight.position.set(1,2,3);
    sunLight.intensity=0.15;
    sunLight.color.setRGB(0.6,0.65,0.8);
  }
}

// Expose getSun globally
window.getSun=window.getSun||function(){return{isDay:true,elevation:0.5,progress:0.5};};

// Animation
function animate(){
  requestAnimationFrame(animate);
  // Update face texture
  window.drawFaceTexture();
  faceTex.needsUpdate=true;
  // Update night mode
  const sun=window.getSun();
  const targetNight=sun.isDay?0:1;
  window.nightMode=window.nightMode||0;
  window.nightMode+=(targetNight-window.nightMode)*0.02; // smooth transition
  // Update glass lighting
  updateGlassLight();
  renderer.render(scene,camera);
}

window.addEventListener('resize',()=>{
  const w=window.innerWidth,h=window.innerHeight;
  renderer.setSize(w,h);
  // Keep orthographic camera covering viewport
  const aspect=w/h;
  if(aspect>1){camera.left=-aspect;camera.right=aspect;camera.top=1;camera.bottom=-1;}
  else{camera.left=-1;camera.right=1;camera.top=1/aspect;camera.bottom=-1/aspect;}
  camera.updateProjectionMatrix();
  // Scale quad to fill
  quad.scale.set(Math.max(aspect,1),Math.max(1/aspect,1),1);
});
window.dispatchEvent(new Event('resize'));

// Init
window.fetchPrayer();
setInterval(window.fetchPrayer,30*60*1000);
setInterval(window.updateInfo,1000);
animate();
</script>
</body>
</html>
